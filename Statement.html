<!doctype html>
<html lang="en" data-layout="vertical" data-topbar="light" data-sidebar="dark" data-sidebar-size="lg"
    data-sidebar-image="none" data-preloader="disable">

<head>

    <meta charset="utf-8" />
    <title>Dashboard | Velzon - Admin & Dashboard Template</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description" />
    <meta content="Themesbrand" name="author" />
    <!-- App favicon -->
    <link rel="shortcut icon" href="assets/images/favicon.ico">
    <!-- jsvectormap css -->
    <link href="assets/libs/jsvectormap/jsvectormap.min.css" rel="stylesheet" type="text/css" />

    <!--Swiper slider css-->
    <link href="assets/libs/swiper/swiper-bundle.min.css" rel="stylesheet" type="text/css" />

    <!-- Layout config Js -->
    <script src="assets/js/layout.js"></script>
    <!-- Bootstrap Css -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <!-- Icons Css -->
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <!-- App Css-->
    <link href="assets/css/app.min.css" rel="stylesheet" type="text/css" />
    <!-- custom Css-->
    <link href="assets/css/custom.min.css" rel="stylesheet" type="text/css" />

    <style>
        /* Custom Styles to match the original structure and improve print */
        body {
            background-color: #f8f9fa;
            /* Light background for the page */
        }

        .card {
            border: 1px solid #e9ecef;
            border-radius: 0.5rem;
        }

        .card-header {
            background-color: #fff;
        }

        .border-bottom-dashed {
            border-bottom: 1px dashed #ced4da !important;
        }

        .border-top-dashed {
            border-top: 1px dashed #ced4da !important;
        }

        .table-active th {
            background-color: #f7f7f7 !important;
        }

        /* Style for the tax input area */
        .tax-input-group {
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }

        .tax-input-group input {
            width: 60px;
            /* Small width for percentage input */
            text-align: right;
            margin-right: 5px;
        }

        .form-control-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
            border-radius: 0.2rem;
        }

        /* Print styles to ensure clean output */
        @media print {
            body {
                background-color: #fff !important;
            }

            .d-print-none {
                display: none !important;
            }

            .col-xxl-9 {
                width: 100% !important;
            }
        }
    </style>


    <!-- Custom Logo Styles -->
    <style>
        .mr-detailer-text {
            font-family: 'Brush Script MT', 'Lucida Handwriting', 'Comic Sans MS', cursive;
            font-size: 28px;
            font-weight: bold;
            font-style: italic;
            color: #000;
            margin: 0;
            padding: 5px 10px;
            white-space: nowrap;
        }
        
        .logo-light .mr-detailer-text {
            color: #fff;
        }
        
        .logo-sm .mr-detailer-text {
            font-size: 22px;
        }
    </style>

                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3 class="mb-0">Statement</h3>
                        <div>
                            <!-- This will trigger DataTables Excel export -->
                            <button id="exportExcel" class="btn btn-sm btn-success">Export Excel</button>
                        </div>
                    </div>

                    <div class="card p-3 mb-3">
                        <div class="d-flex align-items-center gap-3 filters flex-wrap">
                            <div class="col-lg-4 col-md-6">
                                <label class="form-label mb-1">Date Range :</label>
                                <div class="input-group">
                                    <input type="text" class="form-control bg-light flatpickr-input"
                                        id="expense-daterange" data-provider="flatpickr" data-date-format="d M, Y"
                                        data-range-date="true" placeholder="Select date range" readonly>
                                    <span class="input-group-text"><i class="ri-calendar-line"></i></span>
                                </div>
                            </div>

                            <div class="d-flex align-items-center gap-2 mt-4">
                                <label class="mb-0 fw-semibold">Filter By :</label>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="dateType" id="transDate"
                                        value="transaction" checked>
                                    <label class="form-check-label" for="transDate">Transaction Date</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="dateType" id="entryDate"
                                        value="entry">
                                    <label class="form-check-label" for="entryDate">Entry Date</label>
                                </div>
                            </div>

                            <div class="ms-auto">
                                <div class="btn-group toggle-group" role="group" aria-label="Collected / Expenses">
                                    <button type="button" class="btn btn-outline-secondary active"
                                        id="btnAll">All</button>
                                    <button type="button" class="btn btn-outline-secondary"
                                        id="btnCollected">Collected</button>
                                    <button type="button" class="btn btn-outline-secondary"
                                        id="btnExpenses">Expenses</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table id="statementTable" class="table table-striped align-middle table-hover" style="width:100%;">
                                    <thead class="table-light">
                                        <tr>
                                            <th style="width: 120px;">Entry Date</th>
                                            <th style="width: 140px;">Transaction Date</th>
                                            <th>Category</th>
                                            <th>Summary (category – Remark)</th>
                                            <th class="text-center" style="width: 120px;">Debit (₹)</th>
                                            <th class="text-center" style="width: 120px;">Credit (₹)</th>
                                            <th class="text-center" style="width: 140px;">Balance (₹)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>31 Oct 2025</td>
                                            <td>31 Oct 2025</td>
                                            <td>
                                                <span class="fw-medium">Purchase</span>
                                            </td>
                                            <td class="text-muted">PPF-XYZ (5 Year)(6 Services)</td>
                                            <td class="text-center fw-medium">7,000</td>
                                            <td class="text-center">-</td>
                                            <td class="text-center fw-bold">7,000</td>
                                        </tr>

                                        <tr>
                                            <td>02 Nov 2025</td>
                                            <td>27 Jun 2025</td>
                                            <td>
                                                <span class="fw-medium">Booking</span>
                                            </td>
                                            <td class="text-muted">#Booking ID-PPF-ABC (5 Year)(8 Services)</td>
                                            <td class="text-center fw-medium">-</td>
                                            <td class="text-center">43,000</td>
                                            <td class="text-center fw-bold">7,000</td>
                                        </tr>

                                        <tr>
                                            <td>02 Nov 2025</td>
                                            <td>28 Jun 2025</td>
                                            <td>
                                                <span class="fw-medium">Expense</span>
                                            </td>
                                            <td class="text-muted">Travel – Amritsar Trip</td>
                                            <td class="text-center fw-medium">5,000</td>
                                            <td class="text-center">-</td>
                                            <td class="text-center">38,000</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>


                </div>
            </div>
        </div>
    </div>

    <!-- end main content-->
    </div>
    <!-- END layout-wrapper -->


    <!-- footer -->
    <footer class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-6">
                    <div class="text-muted">
                        <script>document.write(new Date().getFullYear())</script> © Velzon.
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="text-sm-end d-none d-sm-block">
                        Design & Develop by Themesbrand
                    </div>
                </div>
            </div>
        </div>
    </footer>


    <!--start back-to-top-->
    <button onclick="topFunction()" class="btn btn-danger btn-icon" id="back-to-top">
        <i class="ri-arrow-up-line"></i>
    </button>
    <!--end back-to-top-->

    <!--preloader-->
    <div id="preloader">
        <div id="status">
            <div class="spinner-border text-primary avatar-sm" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>

    <div class="customizer-setting d-none d-md-block">
        <div class="btn-info rounded-pill shadow-lg btn btn-icon btn-lg p-2" data-bs-toggle="offcanvas"
            data-bs-target="#theme-settings-offcanvas" aria-controls="theme-settings-offcanvas">
            <i class='mdi mdi-spin mdi-cog-outline fs-22'></i>
        </div>
    </div>

    
    </div>
    </div>
    </div>
    </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- JAVASCRIPT -->
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>
    <script src="assets/libs/feather-icons/feather.min.js"></script>
    <script src="assets/js/pages/plugins/lord-icon-2.1.0.js"></script>
    <script src="assets/js/plugins.js"></script>

    <!-- apexcharts -->
    <script src="assets/libs/apexcharts/apexcharts.min.js"></script>

    <!-- Vector map-->
    <script src="assets/libs/jsvectormap/jsvectormap.min.js"></script>
    <script src="assets/libs/jsvectormap/maps/world-merc.js"></script>

    <!--Swiper slider js-->
    <script src="assets/libs/swiper/swiper-bundle.min.js"></script>

    <!-- Dashboard init -->
    <script src="assets/js/pages/dashboard-ecommerce.init.js"></script>

    <!-- App js -->
    <script src="assets/js/app.js"></script>

    

    <script>
            // Initialize date pickers
            (function () {
                var rangeInput = document.getElementById('expense-daterange');
                if (rangeInput && window.flatpickr) {
                    flatpickr(rangeInput, {
                        mode: 'range',
                        dateFormat: 'd M, Y',
                        clickOpens: true
                    });
                }

                var expenseDate = document.getElementById('expenseDate');
                if (expenseDate && window.flatpickr) {
                    flatpickr(expenseDate, {
                        dateFormat: 'd M, Y',
                        defaultDate: 'today'
                    });
                }
            })();
    </script>

    <script>
        // Simple filter + totals for static table
        (function () {
            var tbody = document.getElementById('expenseTbody');
            var rangeInput = document.getElementById('expense-daterange');
            var catFilter = document.getElementById('filterCategory');
            var resetBtn = document.getElementById('btnExpenseReset');
            var dateModeRadios = document.querySelectorAll('input[name="expenseDateMode"]');

            var totalSpan = document.getElementById('totalExpense');
            var cashSpan = document.getElementById('totalCash');
            var onlineSpan = document.getElementById('totalOnline');

            function parseRange(str) {
                if (!str) return { from: null, to: null };
                var parts = str.split(/\s+to\s+/i);
                function parseOne(s) {
                    var d = new Date(s);
                    return isNaN(d) ? null : d;
                }
                if (parts.length === 2) {
                    var from = parseOne(parts[0]);
                    var to = parseOne(parts[1]);
                    if (to) to.setHours(23, 59, 59, 999);
                    return { from: from, to: to };
                }
                var only = parseOne(str);
                return { from: only, to: only };
            }

            function getDateMode() {
                var val = 'transaction';
                dateModeRadios.forEach(function (r) {
                    if (r.checked) val = r.value;
                });
                return val;
            }

            function applyFilters() {
                if (!tbody) return;
                var rows = tbody.querySelectorAll('tr');
                var rangeStr = rangeInput ? (rangeInput.value || '') : '';
                var catVal = catFilter ? (catFilter.value || '') : '';
                var r = parseRange(rangeStr);
                var mode = getDateMode();

                var total = 0;
                var totalCash = 0;
                var totalOnline = 0;

                rows.forEach(function (row) {
                    var cat = row.getAttribute('data-category') || '';
                    var payMode = row.getAttribute('data-mode') || '';
                    var amount = parseFloat(row.getAttribute('data-amount')) || 0;
                    var dateAttr = mode === 'entry' ? 'data-entry-date' : 'data-transaction-date';
                    var dateStr = row.getAttribute(dateAttr);
                    var d = dateStr ? new Date(dateStr) : null;

                    var matchesCat = !catVal || cat === catVal;
                    var matchesDate = true;
                    if (r.from || r.to) {
                        if (!d || isNaN(d)) {
                            matchesDate = false;
                        } else {
                            if (r.from && d < r.from) matchesDate = false;
                            if (r.to && d > r.to) matchesDate = false;
                        }
                    }

                    var visible = matchesCat && matchesDate;
                    row.style.display = visible ? '' : 'none';

                    if (visible) {
                        total += amount;
                        if (payMode === 'cash') totalCash += amount;
                        if (payMode === 'online') totalOnline += amount;
                    }
                });

                if (totalSpan) totalSpan.textContent = 'Rs. ' + total.toLocaleString('en-IN');
                if (cashSpan) cashSpan.textContent = 'Rs. ' + totalCash.toLocaleString('en-IN');
                if (onlineSpan) onlineSpan.textContent = 'Rs. ' + totalOnline.toLocaleString('en-IN');
            }

            if (rangeInput) {
                rangeInput.addEventListener('change', applyFilters);
            }
            if (catFilter) {
                catFilter.addEventListener('change', applyFilters);
            }
            dateModeRadios.forEach(function (r) {
                r.addEventListener('change', applyFilters);
            });
            if (resetBtn) {
                resetBtn.addEventListener('click', function () {
                    if (rangeInput) rangeInput.value = '';
                    if (catFilter) catFilter.value = '';
                    applyFilters();
                });
            }

            if (document.readyState === 'complete' || document.readyState === 'interactive') {
                setTimeout(applyFilters, 0);
            } else {
                document.addEventListener('DOMContentLoaded', applyFilters);
            }
        })();
    </script>

    <script>
        /* Helper: parse dates in formats like "31-Oct-25", "27-jun-25", "28-June-25", "2025-10-31" */
        function parseDateCell(txt) {
            if (!txt) return null;
            txt = txt.trim();
            // ISO yyyy-mm-dd
            if (/^\d{4}-\d{2}-\d{2}$/.test(txt)) return new Date(txt + 'T00:00:00');
            // dd-MMM-yy or dd-MMM-yyyy, case-insensitive month
            const m = txt.match(/^(\d{1,2})-([A-Za-z]+)-(\d{2,4})$/);
            if (m) {
                const d = parseInt(m[1], 10);
                const monStr = m[2].toLowerCase();
                const yRaw = parseInt(m[3], 10);
                const monthMap = { jan: 0, feb: 1, mar: 2, apr: 3, may: 4, jun: 5, jul: 6, aug: 7, sep: 8, oct: 9, nov: 10, dec: 11 };
                const monKey = monStr.slice(0, 3);
                const mon = monthMap[monKey] ?? 0;
                const year = yRaw < 100 ? 2000 + yRaw : yRaw;
                return new Date(year, mon, d, 0, 0, 0);
            }
            // fallback
            const dt = new Date(txt);
            return isNaN(dt) ? null : dt;
        }

        /* Helper: numeric parser (handles "7,000", "-", empty) */
        function parseNumberCell(txt) {
            if (!txt) return 0;
            const s = String(txt).trim();
            if (s === '-' || s === '') return 0;
            return Number(s.replace(/[, ]+/g, '').replace(/[^\d.-]/g, '') || 0);
        }

        /* DataTables custom filtering: date range based on selected dateType, and Collected/Expenses toggle */
        $.fn.dataTable.ext.search.push(function (settings, data, dataIndex, rowData, counter) {
            // This function will be called for every row. We will inspect DOM attributes for robustness.
            const tableRow = settings.aoData[dataIndex].nTr; // DOM TR
            if (!tableRow) return true;

            // get chosen date type
            const dateType = document.querySelector('input[name="dateType"]:checked')?.value || 'transaction';
            const dateAttr = dateType === 'entry' ? tableRow.getAttribute('data-entry') : tableRow.getAttribute('data-transaction');
            const rowDate = parseDateCell(dateAttr || data[(dateType === 'entry') ? 0 : 1]);

            const fromVal = document.getElementById('fromDate').value ? new Date(document.getElementById('fromDate').value + 'T00:00:00') : null;
            const toVal = document.getElementById('toDate').value ? new Date(document.getElementById('toDate').value + 'T23:59:59') : null;

            if (fromVal && rowDate && rowDate < fromVal) return false;
            if (toVal && rowDate && rowDate > toVal) return false;

            // Collected / Expenses / All filter
            const btnCollected = document.getElementById('btnCollected');
            const btnExpenses = document.getElementById('btnExpenses');
            const mode = btnCollected.classList.contains('active') ? 'collected' : btnExpenses.classList.contains('active') ? 'expenses' : 'all';

            // Debit is column index 4, Credit index 5 (0-based)
            const debitVal = parseNumberCell($(tableRow).find('td').eq(4).text());
            const creditVal = parseNumberCell($(tableRow).find('td').eq(5).text());

            if (mode === 'collected' && !(creditVal > 0)) return false;
            if (mode === 'expenses' && !(debitVal > 0)) return false;

            return true;
        });

        $(document).ready(function () {
            // initialize DataTable
            const table = $('#statementTable').DataTable({
                responsive: true,
                pageLength: 10,
                order: [[1, 'desc']], // sort by Transaction Date by default (column index 1)
                columnDefs: [
                    { className: 'dt-right', targets: [4, 5, 6] } // align Debit/Credit/Balance right
                ],
                dom: "<'row mb-2'<'col-sm-6'l><'col-sm-6 text-end'B>>" +
                    "<'row'<'col-sm-12'tr>>" +
                    "<'row mt-2'<'col-sm-6'i><'col-sm-6'p>>",
                buttons: [
                    { extend: 'excelHtml5', text: 'Excel', className: 'btn btn-sm btn-outline-success' },
                    { extend: 'csvHtml5', text: 'CSV', className: 'btn btn-sm btn-outline-secondary' },
                    { extend: 'copyHtml5', text: 'Copy', className: 'btn btn-sm btn-outline-secondary' }
                ],
                initComplete: function () {
                    // If you want export to only include visible (filtered) rows, Buttons already respect current view by default.
                    // Wire external Export Excel button to trigger DataTables' Excel button
                    const dt = this.api();
                    $('#exportExcel').on('click', function () {
                        dt.button(0).trigger(); // 0 -> first button is Excel
                    });
                }
            });

            // Hook up filters: date inputs, radio buttons and toggle buttons
            function applyFilters() { table.draw(); }

            $('#fromDate, #toDate').on('change', applyFilters);
            $('input[name="dateType"]').on('change', applyFilters);

            // toggle buttons behavior
            const btnAll = document.getElementById('btnAll');
            const btnCollected = document.getElementById('btnCollected');
            const btnExpenses = document.getElementById('btnExpenses');

            function clearActive() { [btnAll, btnCollected, btnExpenses].forEach(b => b.classList.remove('active')); }
            btnAll.addEventListener('click', () => { clearActive(); btnAll.classList.add('active'); applyFilters(); });
            btnCollected.addEventListener('click', () => { clearActive(); btnCollected.classList.add('active'); applyFilters(); });
            btnExpenses.addEventListener('click', () => { clearActive(); btnExpenses.classList.add('active'); applyFilters(); });

            // initial draw (applies default Transaction Date & All)
            table.draw();
        });
    </script>

</body>

</html>